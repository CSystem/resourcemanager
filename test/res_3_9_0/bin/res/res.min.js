var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},__promise__line='\n(function(t){function z(){for(var a=0;a<g.length;a++)g[a][0](g[a][1]);g=[];m=!1}function n(a,b){g.push([a,b]);m||(m=!0,A(z,0))}function B(a,b){function c(a){p(b,a)}function h(a){k(b,a)}try{a(c,h)}catch(d){h(d)}}function u(a){var b=a.owner,c=b.state_,b=b.data_,h=a[c];a=a.then;if("function"===typeof h){c=l;try{b=h(b)}catch(d){k(a,d)}}v(a,b)||(c===l&&p(a,b),c===q&&k(a,b))}function v(a,b){var c;try{if(a===b)throw new TypeError("A promises callback cannot return that same promise.");if(b&&("function"===\ntypeof b||"object"===typeof b)){var h=b.then;if("function"===typeof h)return h.call(b,function(d){c||(c=!0,b!==d?p(a,d):w(a,d))},function(b){c||(c=!0,k(a,b))}),!0}}catch(d){return c||k(a,d),!0}return!1}function p(a,b){a!==b&&v(a,b)||w(a,b)}function w(a,b){a.state_===r&&(a.state_=x,a.data_=b,n(C,a))}function k(a,b){a.state_===r&&(a.state_=x,a.data_=b,n(D,a))}function y(a){var b=a.then_;a.then_=void 0;for(a=0;a<b.length;a++)u(b[a])}function C(a){a.state_=l;y(a)}function D(a){a.state_=q;y(a)}function e(a){if("function"!==\ntypeof a)throw new TypeError("Promise constructor takes a function argument");if(!1===this instanceof e)throw new TypeError("Failed to construct \'Promise\': Please use the \'new\' operator, this object constructor cannot be called as a function.");this.then_=[];B(a,this)}var f=t.Promise,s=f&&"resolve"in f&&"reject"in f&&"all"in f&&"race"in f&&function(){var a;new f(function(b){a=b});return"function"===typeof a}();"undefined"!==typeof exports&&exports?(exports.Promise=s?f:e,exports.Polyfill=e):"function"==\ntypeof define&&define.amd?define(function(){return s?f:e}):s||(t.Promise=e);var r="pending",x="sealed",l="fulfilled",q="rejected",E=function(){},A="undefined"!==typeof setImmediate?setImmediate:setTimeout,g=[],m;e.prototype={constructor:e,state_:r,then_:null,data_:void 0,then:function(a,b){var c={owner:this,then:new this.constructor(E),fulfilled:a,rejected:b};this.state_===l||this.state_===q?n(u,c):this.then_.push(c);return c.then},"catch":function(a){return this.then(null,a)}};e.all=function(a){if("[object Array]"!==\nObject.prototype.toString.call(a))throw new TypeError("You must pass an array to Promise.all().");return new this(function(b,c){function h(a){e++;return function(c){d[a]=c;--e||b(d)}}for(var d=[],e=0,f=0,g;f<a.length;f++)(g=a[f])&&"function"===typeof g.then?g.then(h(f),c):d[f]=g;e||b(d)})};e.race=function(a){if("[object Array]"!==Object.prototype.toString.call(a))throw new TypeError("You must pass an array to Promise.race().");return new this(function(b,c){for(var e=0,d;e<a.length;e++)(d=a[e])&&"function"===\ntypeof d.then?d.then(b,c):b(d)})};e.resolve=function(a){return a&&"object"===typeof a&&a.constructor===this?a:new this(function(b){b(a)})};e.reject=function(a){return new this(function(b,c){c(a)})}})("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this);\n';eval(__promise__line),delete __promise__line;var RES;!function(e){e.checkNull=function(e,t,r){var n=r.value;r.value=function(){for(var e=[],r=0;r<arguments.length;r++)e[r-0]=arguments[r];return e[0]?n.apply(this,e):(console.warn("方法"+t+"的参数不能为null"),null)}},e.checkDecorator=function(t,r,n){var o=n.value;n.value=function(t,r){return r&&console.warn("已经废弃 resourceRoot"),t&&console.warn("已经废弃 url"),console.assert(e.configItem,"需要为文档类添加 RES.mapConfig 注解"),o.apply(this)}}}(RES||(RES={}));var RES;!function(e){function t(e){return o.getFile(e)}function r(){console.log(e.data)}var n;!function(e){e[e.FILE=0]="FILE",e[e.DICTIONARY=1]="DICTIONARY"}(n||(n={})),e.getResourceInfo=t,e.print=r;var o;!function(e){function t(e,t){t||(t=""),e=o(e);var r=n(e),c=a(e);u(c)||s(c);var f=i(c);f[r]={url:e,type:t}}function r(e){return i(e)}function n(e){return e.substr(e.lastIndexOf("/")+1)}function o(e){return e.split("/").filter(function(e){return!!e}).join("/")}function a(e){return e.substr(0,e.lastIndexOf("/"))}function i(t){t=o(t);for(var r=t.split("/"),n=e.data,a=0,i=r;a<i.length;a++){var s=i[a];n=n[s]}return n}function s(t){t=o(t);for(var r=t.split("/"),n=e.data,a=0,i=r;a<i.length;a++){var s=i[a];n[s]||(n[s]={}),n=n[s]}}function u(t){t=o(t);for(var r=t.split("/"),n=e.data,a=0,i=r;a<i.length;a++){var s=i[a];if(!n[s])return!1;n=n[s]}return!0}e.data={},e.addFile=t,e.getFile=r,e.mkdir=s,e.exists=u}(o=e.FileSystem||(e.FileSystem={}))}(RES||(RES={}));var RES;!function(e){var t;!function(t){function r(t){var r,n=e.configInstance;if(n.config)for(var o in n.config.alias)n.config.alias[o]==t.url&&(r=o);else r=t.url;var a={name:r,url:t.url,type:t.type,data:t};return a}t.TYPE_IMAGE="image",t.convertToResItem=r}(t=e.ResourceItem||(e.ResourceItem={}))}(RES||(RES={}));var RES;!function(e){var t=function(){function t(){e.configInstance=this}return t.prototype.getGroupByName=function(e,t){var r=this.config.groups[e],n=[];if(!r){if(t)throw"none group "+e;return null}for(var o=0,a=r;o<a.length;o++){var i=a[o],s=this.getResource(i,!0);n.push(s)}return n},t.prototype.__temp__get__type__via__url=function(e){var t=this.config.alias[e];t||(t=e);var r=t.substr(t.lastIndexOf(".")+1);r&&(r=r.toLowerCase());var n;switch(r){case"xml":case"json":case"sheet":n=r;break;case"png":case"jpg":case"gif":case"jpeg":case"bmp":n="image";break;case"fnt":n="font";break;case"txt":n="text";break;case"mp3":case"ogg":case"mpeg":case"wav":case"m4a":case"mp4":case"aiff":case"wma":case"mid":n="sound";break;case"jmc":n="json";break;default:n="bin"}return n},t.prototype.getKeyByAlias=function(e){return this.config.alias[e]?this.config.alias[e]:e},t.prototype.getResource=function(t,r){var n=this.config.alias[t];n||(n=t);var o=e.getResourceInfo(n);if(!o){if(r)throw"none resource url or alias : "+t;return null}return o},t.prototype.getGroup=function(e){return this.getGroupByName(e)},t.prototype.createGroup=function(e,t,r){if(void 0===r&&(r=!1),!r&&this.config.groups[e]||!t||0==t.length)return!1;for(var n=[],o=0,a=t;o<a.length;o++){var i=a[o];if(this.config.groups[i]){var s=this.config.groups[i];n=n.concat(s)}else this.config.alias[i]||this.config.resources[i]?n=n.concat(i):(n=n.concat(i),console.warn("resource not exist : "+i))}return this.config.groups[e]=n,!0},t.prototype.parseConfig=function(t,r){this.config=t,e.FileSystem.data=t.resources},t.prototype.addSubkey=function(e,t){this.addAlias(e,t)},t.prototype.addAlias=function(e,t){this.config.alias[t]&&(t=this.config.alias[t]),this.config.alias[e]=t+"#"+e},t.prototype.getType=function(e){return this.getResource(e,!0).type},t.prototype.addResourceData=function(t){t.type||(t.type=this.__temp__get__type__via__url(t.url)),e.FileSystem.addFile(t.url,t.type),t.name&&(this.config.alias[t.name]=t.url)},t}();e.ResourceConfig=t}(RES||(RES={}));var RES;!function(e){var t=function(){function t(){}return t.prototype.loadGroup=function(t,r){var n=0,o=t.length,a=function(t){return e.host.load(t).then(function(a){e.host.save(t,a),n++,r&&r.onProgress&&r.onProgress(n,o)})};return Promise.all(t.map(a))},t}();e.PromiseQueue=t}(RES||(RES={}));var RES;!function(e){var t=function(t){function r(e,r,n){void 0===r&&(r=!1),void 0===n&&(n=!1),t.call(this,e,r,n),this.itemsLoaded=0,this.itemsTotal=0,this.groupName=""}return __extends(r,t),r.dispatchResourceEvent=function(t,n,o,a,i,s){void 0===o&&(o=""),void 0===a&&(a=void 0),void 0===i&&(i=0),void 0===s&&(s=0);var u=egret.Event.create(r,n);u.groupName=o,a&&(u.resItem=e.ResourceItem.convertToResItem(a)),u.itemsLoaded=i,u.itemsTotal=s;var c=t.dispatchEvent(u);return egret.Event.release(u),c},r}(egret.Event);t.ITEM_LOAD_ERROR="itemLoadError",t.CONFIG_COMPLETE="configComplete",t.CONFIG_LOAD_ERROR="configLoadError",t.GROUP_PROGRESS="groupProgress",t.GROUP_COMPLETE="groupComplete",t.GROUP_LOAD_ERROR="groupLoadError",e.ResourceEvent=t}(RES||(RES={}));var RES;!function(e){var t=function(t){function r(){t.call(this),this.resourceConfig=e.configInstance}return __extends(r,t),r.prototype.addSubkey=function(e,t){this.resourceConfig.addSubkey(e,t)},r.prototype.loadFile=function(e,t,r){},r.prototype.getRes=function(e,t){},r.prototype.destroyRes=function(e){return!1},r.getStringPrefix=function(e){if(!e)return"";var t=e.indexOf(".");return t!=-1?e.substring(0,t):""},r}(egret.HashObject);e.AnalyzerBase=t}(RES||(RES={}));var __awaiter=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,a){function i(e){try{u(n.next(e))}catch(e){a(e)}}function s(e){try{u(n.throw(e))}catch(e){a(e)}}function u(e){e.done?o(e.value):new r(function(t){t(e.value)}).then(i,s)}u((n=n.apply(e,t)).next())})},__generator=this&&this.__generator||function(e,t){function r(r){if(o)throw new TypeError("Generator is already executing.");for(;;){if(a.done)switch(r[0]){case 0:return{value:void 0,done:!0};case 1:case 6:throw r[1];case 2:return{value:r[1],done:!0}}try{switch(o=1,r[0]){case 0:case 1:n=r;break;case 4:return a.label++,{value:r[1],done:!1};case 7:r=a.stack.pop(),a.trys.pop();continue;default:var i=a.trys.length>0&&a.trys[a.trys.length-1];if(!i&&(6===r[0]||2===r[0])){a.done=1;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){a.label=r[1];break}if(6===r[0]&&a.label<i[1]){a.label=i[1],n=r;break}if(i&&a.label<i[2]){a.label=i[2],a.stack.push(r);break}i[2]&&a.stack.pop(),a.trys.pop();continue}r=t.call(e,a)}catch(e){r=[6,e]}finally{o=0,n=void 0}}}var n,o,a={label:0,sent:function(){if(1===n[0])throw n[1];return n[1]},trys:[],stack:[]};return{next:function(e){return r([0,e])},throw:function(e){return r([1,e])},return:function(e){return r([2,e])}}},RES;!function(e){function t(e,t){return __awaiter(this,void 0,void 0,function(){return r=this,__generator(this,function(n){return[2,new Promise(function(n,o){var a=function(){var t=e.data?e.data:e.response;n(t)},i=function(){var e={code:1001,message:"文件加载失败:'"+t.url+"'"};o(e)};e.addEventListener(egret.Event.COMPLETE,a,r),e.addEventListener(egret.IOErrorEvent.IO_ERROR,i,r)})]})});var r}function r(e,t){e=e.split("\\").join("/");var r=e.match(/#.*|\?.*/),n="";r&&(n=r[0]);var o=e.lastIndexOf("/");return e=o!=-1?e.substring(0,o+1)+t:t,e+n}e.getRelativePath=r,e.ImageProcessor={onLoadStart:function(e,r){return __awaiter(this,void 0,void 0,function(){var e,n,o;return __generator(this,function(a){switch(a.label){case 0:return e=new egret.ImageLoader,e.load("resource/"+r.url),[4,t(e,r)];case 1:return n=a.sent(),o=new egret.Texture,o._setBitmapData(n),[2,o]}})})},onRemoveStart:function(e,t){var r=e.get(t);return r.dispose(),Promise.resolve()}},e.TextProcessor={onLoadStart:function(e,r){return __awaiter(this,void 0,void 0,function(){var e,n;return __generator(this,function(o){switch(o.label){case 0:return e=new egret.HttpRequest,e.responseType=egret.HttpResponseType.TEXT,e.open("resource/"+r.url,"get"),e.send(),[4,t(e,r)];case 1:return n=o.sent(),[2,n]}})})},onRemoveStart:function(e,t){return Promise.resolve()}},e.JsonProcessor={onLoadStart:function(t,r){return __awaiter(this,void 0,void 0,function(){var n,o;return __generator(this,function(a){switch(a.label){case 0:return[4,t.load(r,e.TextProcessor)];case 1:return n=a.sent(),o=JSON.parse(n),[2,o]}})})},onRemoveStart:function(e,t){return Promise.resolve()}},e.XMLProcessor={onLoadStart:function(t,r){return __awaiter(this,void 0,void 0,function(){var n,o;return __generator(this,function(a){switch(a.label){case 0:return[4,t.load(r,e.TextProcessor)];case 1:return n=a.sent(),o=egret.XML.parse(n),[2,o]}})})},onRemoveStart:function(e,t){return Promise.resolve()}},e.SheetProcessor={onLoadStart:function(t,n){return __awaiter(this,void 0,void 0,function(){var o,a,i,s,u,c,f,l,s;return __generator(this,function(p){switch(p.label){case 0:return[4,t.load(n,e.JsonProcessor)];case 1:if(o=p.sent(),a=r(n.url,o.file),t.resourceConfig.addResourceData({name:a,type:"image",url:a}),i=t.resourceConfig.getResource(a),!i)throw"error";return[4,t.load(i)];case 2:if(s=p.sent(),u=o.frames,!u)throw"error";c=new egret.SpriteSheet(s);for(f in u)l=u[f],s=c.createTexture(f,l.x,l.y,l.w,l.h,l.offX,l.offY,l.sourceW,l.sourceH);return[2,c]}})})},onRemoveStart:function(e,t){return Promise.resolve()}}}(RES||(RES={}));var __decorate=this&&this.__decorate||function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},RES;!function(e){function t(e,t){m.registerAnalyzer(e,t)}function r(e,t){return m.loadConfig()}function n(e,t,r){return void 0===t&&(t=0),m.loadGroup(e,t,r)}function o(e){return m.isGroupLoaded(e)}function a(t){return m.getGroupByName(t).map(function(t){return e.ResourceItem.convertToResItem(t)})}function i(e,t,r){return void 0===r&&(r=!1),m.createGroup(e,t,r)}function s(e){return m.hasRes(e)}function u(e){return m.getRes(e)}function c(e,t,r){m.getResAsync.apply(m,arguments)}function f(e,t,r,n){void 0===n&&(n=""),m.getResByUrl(e,t,r,n)}function l(e,t){return m.destroyRes(e,t)}function p(e){m.setMaxLoadingThread(e)}function d(e){m.setMaxRetryTimes(e)}function h(e,t,r,n,o){void 0===n&&(n=!1),void 0===o&&(o=0),m.addEventListener(e,t,r,n,o)}function g(e,t,r,n){void 0===n&&(n=!1),m.removeEventListener(e,t,r,n)}function v(e){m.addResourceData(e)}function y(t,r){return function(n){var o,a="json";o="string"==typeof r?r:r(),0!=o.lastIndexOf("/")&&(o+="/"),e.configItem={url:t,resourceRoot:o,type:a,name:t}}}var R={};e.host={get resourceConfig(){return e.configInstance},load:function(t,r){if(r||(r=e.host.isSupport(t)),!r)throw"error";return r.onLoadStart(e.host,t)},unload:function(t){var r=e.host.isSupport(t);return r?r.onRemoveStart(e.host,t):Promise.resolve()},save:function(e,t){R[e.url]=t},get:function(e){return R[e.url]},remove:function(e){delete R[e.url]},isSupport:function(t){var r=t.type,n={image:e.ImageProcessor,json:e.JsonProcessor,text:e.TextProcessor,xml:e.XMLProcessor,sheet:e.SheetProcessor};return n[r]}},e.registerAnalyzer=t,e.loadConfig=r,e.loadGroup=n,e.isGroupLoaded=o,e.getGroupByName=a,e.createGroup=i,e.hasRes=s,e.getRes=u,e.getResAsync=c,e.getResByUrl=f,e.destroyRes=l,e.setMaxLoadingThread=p,e.setMaxRetryTimes=d,e.addEventListener=h,e.removeEventListener=g,e.$addResourceData=v;var _=function(t){function r(){t.call(this),this.groupNameList=[],this.init()}return __extends(r,t),r.prototype.parseResKey=function(e){e=this.resConfig.getKeyByAlias(e);var t=e.indexOf("#");return t>=0?{key:e.substr(0,t),subkey:e.substr(t+1)}:{key:e,subkey:""}},r.prototype.registerAnalyzer=function(e,t){throw"unimplement"},r.prototype.init=function(){this.resConfig=new e.ResourceConfig,this.resLoader=new e.PromiseQueue},r.prototype.loadConfig=function(){var t=this;return e.host.load(e.configItem).then(function(r){t.resConfig.parseConfig(r,"resource"),e.ResourceEvent.dispatchResourceEvent(t,e.ResourceEvent.CONFIG_COMPLETE)})},r.prototype.isGroupLoaded=function(e){return!1},r.prototype.getGroupByName=function(e){return this.resConfig.getGroupByName(e)},r.prototype.loadGroup=function(e,t,r){void 0===t&&(t=0);var n=this.resConfig.getGroupByName(e);return this.resLoader.loadGroup(n,r)},r.prototype.createGroup=function(e,t,r){return void 0===r&&(r=!1),this.resConfig.createGroup(e,t,r)},r.prototype.hasRes=function(e){var t=this.parseResKey(e).key;return null!=this.resConfig.getResource(t)},r.prototype.getRes=function(t){var r=this.parseResKey(t),n=r.key,o=(r.subkey,this.resConfig.getResource(n));if(o&&e.host.isSupport(o))return e.host.get(o)},r.prototype.getResAsync=function(t,r,n){var o=this;if(!r)return new Promise(function(e,r){return c(t,e,o)});var a=this.parseResKey(t),t=a.key,i=(a.subkey,this.resConfig.getResource(t,!0)),s=(i.url,e.host.get(i));s?egret.$callAsync(r,n,s,t):e.host.load(i).then(function(t){e.host.save(i,t),r.call(n,t,i.url)})},r.prototype.getResByUrl=function(e,t,r,n){void 0===n&&(n="");var o=this.resConfig.getResource(e);o||this.resConfig.addResourceData({name:e,url:e}),this.getResAsync(e,t,r)},r.prototype.destroyRes=function(t,r){void 0===r&&(r=!0);var n=this.resConfig.getGroup(t),o=function(t){e.host.unload(t),e.host.remove(t)};if(n&&n.length>0){for(var a=0,i=n;a<i.length;a++){var s=i[a];o(s)}return!0}var s=this.resConfig.getResource(t);return s?(o(s),!0):(console.warn("无法删除指定组:"+t),!1)},r.prototype.setMaxLoadingThread=function(e){e<1&&(e=1)},r.prototype.setMaxRetryTimes=function(e){e=Math.max(e,0)},r.prototype.addResourceData=function(e){this.resConfig.addResourceData(e)},r}(egret.EventDispatcher);__decorate([e.checkDecorator],_.prototype,"loadConfig",null),__decorate([e.checkNull],_.prototype,"getRes",null),e.Resource=_;var m=new _;e.mapConfig=y}(RES||(RES={}));var egret;!function(e){e.$locale_strings=e.$locale_strings||{},e.$locale_strings.zh_CN=e.$locale_strings.zh_CN||{};var t=e.$locale_strings.zh_CN;t[3200]="RES.createGroup()传入了配置中不存在的键值: {0}",t[3201]='RES加载了不存在或空的资源组:"{0}"',t[3202]="请不要使用不同的类型方式来加载同一个素材！",t[3203]="找不到指定文件类型的解析器:{0}。 请先在项目初始化里注册指定文件类型的解析器，再启动资源加载。"}(egret||(egret={}));