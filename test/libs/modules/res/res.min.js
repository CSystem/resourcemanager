var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},__decorate=this&&this.__decorate||function(e,t,r,i){var o,n=arguments.length,s=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(n<3?o(s):n>3?o(t,r,s):o(t,r))||s);return n>3&&s&&Object.defineProperty(t,r,s),s},RES;!function(e){e.checkNull=function(e,t,r){var i=r.value;r.value=function(){for(var e=[],r=0;r<arguments.length;r++)e[r-0]=arguments[r];return e[0]?i.apply(this,e):(console.warn("方法"+t+"的参数不能为null"),null)}},e.checkDecorator=function(t,r,i){var o=i.value;i.value=function(t,r){return r&&console.warn("已经废弃 resourceRoot"),t&&console.warn("已经废弃 url"),console.assert(e.configItem,"需要为文档类添加 RES.mapConfig 注解"),o.apply(this)}}}(RES||(RES={}));var RES;!function(e){var t;!function(t){function r(t){var r,i=e.configInstance;if(i.config)for(var o in i.config.alias)i.config.alias[o]==t.url&&(r=o);else r=t.url;var n={name:r,url:t.url,type:t.type,data:t,groupName:"",loaded:!0};return n}t.TYPE_IMAGE="image",t.convertToResItem=r}(t=e.ResourceItem||(e.ResourceItem={}))}(RES||(RES={}));var RES;!function(e){var t=function(){function t(){e.configInstance=this}return t.prototype.getGroupByName=function(e,t){var r=this.config.groups[e],i=[];if(!r){if(t)throw"none group "+e;return null}for(var o=0,n=r;o<n.length;o++){var s=n[o],a=this.getResource(s,!0);i.push(a)}return i},t.prototype.__temp__get__type__via__url=function(e){var t=this.config.alias[e];t||(t=e);var r=t.substr(t.lastIndexOf(".")+1);r&&(r=r.toLowerCase());var i;switch(r){case"xml":case"json":case"sheet":i=r;break;case"png":case"jpg":case"gif":case"jpeg":case"bmp":i="image";break;case"fnt":i="font";break;case"txt":i="text";break;case"mp3":case"ogg":case"mpeg":case"wav":case"m4a":case"mp4":case"aiff":case"wma":case"mid":i="sound";break;case"jmc":i="json";break;default:i="bin"}return i},t.prototype.getKeyByAlias=function(e){return this.config.alias[e]?this.config.alias[e]:e},t.prototype.getResource=function(e,t){var r=this.config.alias[e];r||(r=e);var i=this.config.resources[r];if(!i){if(t)throw"none resource url or alias : "+e;return null}return i},t.prototype.getGroup=function(e){return this.getGroupByName(e)},t.prototype.createGroup=function(e,t,r){if(void 0===r&&(r=!1),!r&&this.config.groups[e]||!t||0==t.length)return!1;for(var i=[],o=0,n=t;o<n.length;o++){var s=n[o];if(this.config.groups[s]){var a=this.config.groups[s];i=i.concat(a)}else this.config.alias[s]||this.config.resources[s]?i=i.concat(s):(i=i.concat(s),console.warn("resource not exist : "+s))}return this.config.groups[e]=i,!0},t.prototype.parseConfig=function(e,t){var r=e.resources;for(var i in r){var o=r[i];o.url=t+"/"+o.url,o.name=i}this.config=e},t.prototype.addSubkey=function(e,t){this.addAlias(e,t)},t.prototype.addAlias=function(e,t){this.config.alias[t]&&(t=this.config.alias[t]),this.config.alias[e]=t+"#"+e},t.prototype.getType=function(e){return this.getResource(e,!0).type},t.prototype.addResourceData=function(e){e.type||(e.type=this.__temp__get__type__via__url(e.url)),this.config.resources[e.url]=e,e.name&&(this.config.alias[e.name]=e.url)},t}();e.ResourceConfig=t}(RES||(RES={}));var RES;!function(e){var t=function(t){function r(){t.call(this),this.thread=2,this.loadingCount=0,this.groupTotalDic={},this.numLoadedDic={},this.itemListDic={},this.groupErrorDic={},this.retryTimesDic={},this.maxRetryTimes=3,this.failedList=new Array,this.priorityQueue={},this.lazyLoadList=new Array,this.analyzerDic={},this.queueIndex=0}return __extends(r,t),r.prototype.isGroupInLoading=function(e){return void 0!==this.itemListDic[e]},r.prototype.loadGroup=function(t,r,i){if(void 0===i&&(i=0),!this.itemListDic[r]&&r){if(!t||0==t.length){egret.$warn(3201,r);var o=new e.ResourceEvent(e.ResourceEvent.GROUP_LOAD_ERROR);return o.groupName=r,void this.dispatchEvent(o)}this.priorityQueue[i]?this.priorityQueue[i].push(r):this.priorityQueue[i]=[r],this.itemListDic[r]=t;for(var n=t.length,s=0;s<n;s++){var a=t[s];a.groupName=r}this.groupTotalDic[r]=t.length,this.numLoadedDic[r]=0,this.next()}},r.prototype.loadItem=function(e){this.lazyLoadList.push(e),e.groupName="",this.next()},r.prototype.next=function(){for(var t=this;this.loadingCount<this.thread;){var r=this.getOneResourceItem();if(!r)break;if(this.loadingCount++,r.loaded)this.onItemComplete(r);else if(e.host.isSupport(r))e.host.execute(e.ImageProcessor,r).then(function(e){e.loaded=!0,t.onItemComplete(e)});else{var i=this.resInstance.$getAnalyzerByType(r.type);i.loadFile(r,this.onItemComplete,this)}}},r.prototype.getOneResourceItem=function(){if(this.failedList.length>0)return this.failedList.shift();var e=Number.NEGATIVE_INFINITY;for(var t in this.priorityQueue)e=Math.max(e,t);var r=this.priorityQueue[e];if(!r||0==r.length){if(0==this.lazyLoadList.length)return;return this.lazyLoadList.pop()}for(var i=r.length,o=[],n=0;n<i&&(this.queueIndex>=i&&(this.queueIndex=0),o=this.itemListDic[r[this.queueIndex]],!(o.length>0));n++)this.queueIndex++;return 0!=o.length?o.shift():void 0},r.prototype.onItemComplete=function(t){this.loadingCount--;var r=t.groupName;if(!t.loaded){var i=this.retryTimesDic[t.name]||1;if(!(i>this.maxRetryTimes))return this.retryTimesDic[t.name]=i+1,this.failedList.push(t),void this.next();delete this.retryTimesDic[t.name],e.ResourceEvent.dispatchResourceEvent(this.resInstance,e.ResourceEvent.ITEM_LOAD_ERROR,r,t)}if(r){this.numLoadedDic[r]++;var o=this.numLoadedDic[r],n=this.groupTotalDic[r];if(t.loaded||(this.groupErrorDic[r]=!0),e.ResourceEvent.dispatchResourceEvent(this.resInstance,e.ResourceEvent.GROUP_PROGRESS,r,t,o,n),o==n){var s=this.groupErrorDic[r];this.removeGroupName(r),delete this.groupTotalDic[r],delete this.numLoadedDic[r],delete this.itemListDic[r],delete this.groupErrorDic[r],s?e.ResourceEvent.dispatchResourceEvent(this,e.ResourceEvent.GROUP_LOAD_ERROR,r):e.ResourceEvent.dispatchResourceEvent(this,e.ResourceEvent.GROUP_COMPLETE,r)}}else this.callBack.call(this.resInstance,t);this.next()},r.prototype.removeGroupName=function(e){for(var t in this.priorityQueue){for(var r=this.priorityQueue[t],i=r.length,o=0,n=!1,i=r.length,s=0;s<i;s++){var a=r[s];if(a==e){r.splice(o,1),n=!0;break}o++}if(n){0==r.length&&delete this.priorityQueue[t];break}}},r}(egret.EventDispatcher);e.ResourceLoader=t}(RES||(RES={}));var RES;!function(e){var t=function(t){function r(e,r,i){void 0===r&&(r=!1),void 0===i&&(i=!1),t.call(this,e,r,i),this.itemsLoaded=0,this.itemsTotal=0,this.groupName=""}return __extends(r,t),r.dispatchResourceEvent=function(t,i,o,n,s,a){void 0===o&&(o=""),void 0===n&&(n=void 0),void 0===s&&(s=0),void 0===a&&(a=0);var u=egret.Event.create(r,i);u.groupName=o,n&&(u.resItem=e.ResourceItem.convertToResItem(n)),u.itemsLoaded=s,u.itemsTotal=a;var c=t.dispatchEvent(u);return egret.Event.release(u),c},r.ITEM_LOAD_ERROR="itemLoadError",r.CONFIG_COMPLETE="configComplete",r.CONFIG_LOAD_ERROR="configLoadError",r.GROUP_PROGRESS="groupProgress",r.GROUP_COMPLETE="groupComplete",r.GROUP_LOAD_ERROR="groupLoadError",r}(egret.Event);e.ResourceEvent=t}(RES||(RES={}));var RES;!function(e){var t=function(t){function r(){t.call(this),this.resourceConfig=e.configInstance}return __extends(r,t),r.prototype.addSubkey=function(e,t){this.resourceConfig.addSubkey(e,t)},r.prototype.loadFile=function(e,t,r){},r.prototype.getRes=function(e,t){},r.prototype.destroyRes=function(e){return!1},r.getStringPrefix=function(e){if(!e)return"";var t=e.indexOf(".");return t!=-1?e.substring(0,t):""},r}(egret.HashObject);e.AnalyzerBase=t}(RES||(RES={}));var RES;!function(e){var t=function(t){function r(){t.call(this),this.fileDic={},this.resItemDic=[],this._dataFormat=egret.HttpResponseType.ARRAY_BUFFER,this.recycler=[]}return __extends(r,t),r.prototype.loadFile=function(t,r,i){if(this.fileDic[t.name])return void r.call(i,t);var o=this.getRequest();this.resItemDic[o.hashCode]={item:t,func:r,thisObject:i},o.open(e.$getVirtualUrl(t)),o.send()},r.prototype.getRequest=function(){var e=this.recycler.pop();return e||(e=new egret.HttpRequest,e.addEventListener(egret.Event.COMPLETE,this.onLoadFinish,this),e.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onLoadFinish,this)),e.responseType=this._dataFormat,e},r.prototype.onLoadFinish=function(e){var t=e.target,r=this.resItemDic[t.hashCode];delete this.resItemDic[t.hashCode];var i=r.item,o=r.func;i.loaded=e.type==egret.Event.COMPLETE,i.loaded&&this.analyzeData(i,t.response),this.recycler.push(t),o.call(r.thisObject,i)},r.prototype.analyzeData=function(e,t){var r=e.name;this.fileDic[r]||""!=t&&!t||(this.fileDic[r]=t)},r.prototype.getRes=function(e){return this.fileDic[e]},r.prototype.hasRes=function(e){var t=this.getRes(e);return null!=t},r.prototype.destroyRes=function(e){return!!this.fileDic[e]&&(this.onResourceDestroy(this.fileDic[e]),delete this.fileDic[e],!0)},r.prototype.onResourceDestroy=function(e){},r}(e.AnalyzerBase);e.BinAnalyzer=t}(RES||(RES={}));var RES;!function(e){var t=function(t){function r(){t.call(this),this.fileDic={},this.resItemDic=[],this.recycler=[]}return __extends(r,t),r.prototype.loadFile=function(t,r,i){if(this.fileDic[t.url])return void r.call(i,t);var o=this.getLoader();this.resItemDic[o.$hashCode]={item:t,func:r,thisObject:i},o.load(e.$getVirtualUrl(t))},r.prototype.getLoader=function(){var e=this.recycler.pop();return e||(e=new egret.ImageLoader,e.addEventListener(egret.Event.COMPLETE,this.onLoadFinish,this),e.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onLoadFinish,this)),e},r.prototype.onLoadFinish=function(e){var t=e.$target,r=this.resItemDic[t.$hashCode];delete this.resItemDic[t.$hashCode];var i=r.item,o=r.func;if(i.loaded=e.$type==egret.Event.COMPLETE,i.loaded){var n=new egret.Texture;n._setBitmapData(t.data),this.analyzeData(i,n)}this.recycler.push(t),o.call(r.thisObject,i)},r.prototype.analyzeData=function(e,t){var r=e.url;if(!this.fileDic[r]&&t){this.fileDic[r]=t;var i=e.data;if(i&&i.scale9grid){var o=i.scale9grid,n=o.split(",");t.scale9Grid=new egret.Rectangle(parseInt(n[0]),parseInt(n[1]),parseInt(n[2]),parseInt(n[3]))}}},r.prototype.getRes=function(e){return this.fileDic[e]},r.prototype.hasRes=function(e){var t=this.getRes(e);return null!=t},r.prototype.destroyRes=function(e){return!!this.fileDic[e]&&(this.onResourceDestroy(this.fileDic[e]),delete this.fileDic[e],!0)},r.prototype.onResourceDestroy=function(e){e.dispose()},r}(e.AnalyzerBase);e.ImageAnalyzer=t}(RES||(RES={}));var RES;!function(e){var t=function(e){function t(){e.call(this),this._dataFormat=egret.HttpResponseType.TEXT}return __extends(t,e),t}(e.BinAnalyzer);e.TextAnalyzer=t}(RES||(RES={}));var RES;!function(e){var t=function(e){function t(){e.call(this),this._dataFormat=egret.HttpResponseType.TEXT}return __extends(t,e),t.prototype.analyzeData=function(e,t){var r=e.url;if(!this.fileDic[r]&&t)try{var i=t;this.fileDic[r]=JSON.parse(i)}catch(r){egret.$warn(1017,e.url,t)}},t}(e.BinAnalyzer);e.JsonAnalyzer=t}(RES||(RES={}));var RES;!function(e){var t=function(t){function r(){t.call(this),this.sheetMap={},this.textureMap={},this.recyclerIamge=[],this._dataFormat=egret.HttpResponseType.TEXT}return __extends(r,t),r.prototype.getRes=function(e,t){var r=this.fileDic[e];return r&&t?r.getTexture(t):r},r.prototype.onLoadFinish=function(e){var t=e.target,r=this.resItemDic[t.$hashCode];delete this.resItemDic[t.hashCode];var i=r.item,o=r.func;if(i.loaded=e.type==egret.Event.COMPLETE,i.loaded)if(t instanceof egret.HttpRequest){i.loaded=!1;var n=this.analyzeConfig(i,t.response);if(n)return this.loadImage(n,r),void this.recycler.push(t)}else{var s=new egret.Texture;s._setBitmapData(t.data),this.analyzeBitmap(i,s)}t instanceof egret.HttpRequest?this.recycler.push(t):this.recyclerIamge.push(t),o.call(r.thisObject,i)},r.prototype.analyzeConfig=function(e,t){var r,i=e.url,o="";try{var n=t;r=JSON.parse(n)}catch(r){egret.$warn(1017,e.url,t)}return r&&(this.sheetMap[i]=r,o=this.getRelativePath(e.url,r.file)),o},r.prototype.analyzeBitmap=function(e,t){var r=e.url;if(!this.fileDic[r]&&t){var i=this.sheetMap[r];delete this.sheetMap[r];var o="sheet"==e.type?"":r,n=this.parseSpriteSheet(t,i,o);this.fileDic[r]=n}},r.prototype.getRelativePath=function(e,t){e=e.split("\\").join("/");var r=e.match(/#.*|\?.*/),i="";r&&(i=r[0]);var o=e.lastIndexOf("/");return e=o!=-1?e.substring(0,o+1)+t:t,e+i},r.prototype.parseSpriteSheet=function(e,t,r){var i=t.frames;if(!i)throw"error";var o=new egret.SpriteSheet(e),n=this.textureMap;for(var s in i){var a=i[s],e=o.createTexture(s,a.x,a.y,a.w,a.h,a.offX,a.offY,a.sourceW,a.sourceH);if(a.scale9grid){var u=a.scale9grid,c=u.split(",");e.scale9Grid=new egret.Rectangle(parseInt(c[0]),parseInt(c[1]),parseInt(c[2]),parseInt(c[3]))}null==n[s]&&(n[s]=e,r&&this.addSubkey(s,r))}return o},r.prototype.destroyRes=function(e){var t=this.fileDic[e];if(t){delete this.fileDic[e];var r;for(var i in t._textureMap)null==r&&(r=t._textureMap[i],this.onResourceDestroy(r),r=null),delete this.textureMap[i];return!0}return!1},r.prototype.loadImage=function(t,r){var i=this.getImageLoader();this.resItemDic[i.hashCode]=r,i.load(e.getVirtualUrl(t))},r.prototype.getImageLoader=function(){var e=this.recyclerIamge.pop();return e||(e=new egret.ImageLoader,e.addEventListener(egret.Event.COMPLETE,this.onLoadFinish,this),e.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onLoadFinish,this)),e},r.prototype.onResourceDestroy=function(e){e&&e.dispose()},r}(e.BinAnalyzer);e.SheetAnalyzer=t}(RES||(RES={}));var RES;!function(e){var t=function(e){function t(){e.call(this)}return __extends(t,e),t.prototype.analyzeConfig=function(e,t){var r,i=e.url,o="";try{var n=t;r=JSON.parse(n)}catch(e){}return r?o=this.getRelativePath(e.url,r.file):(r=t,o=this.getTexturePath(e.url,r)),this.sheetMap[i]=r,o},t.prototype.analyzeBitmap=function(e,t){var r=e.url;if(!this.fileDic[r]&&t){var i=this.sheetMap[r];delete this.sheetMap[r];var o=new egret.BitmapFont(t,i);this.fileDic[r]=o}},t.prototype.getTexturePath=function(e,t){var r="",i=t.split("\n"),o=i[2],n=o.indexOf('file="');n!=-1&&(o=o.substring(n+6),n=o.indexOf('"'),r=o.substring(0,n)),e=e.split("\\").join("/");var n=e.lastIndexOf("/");return e=n!=-1?e.substring(0,n+1)+r:r},t.prototype.onResourceDestroy=function(e){e&&e.dispose()},t}(e.SheetAnalyzer);e.FontAnalyzer=t}(RES||(RES={}));var RES;!function(e){var t=function(t){function r(){t.call(this),this.soundDic={},this.resItemDic=[]}return __extends(r,t),r.prototype.loadFile=function(t,r,i){if(this.soundDic[t.url])return void r.call(i,t);var o=new egret.Sound;o.addEventListener(egret.Event.COMPLETE,this.onLoadFinish,this),o.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onLoadFinish,this),this.resItemDic[o.$hashCode]={item:t,func:r,thisObject:i},o.load(e.$getVirtualUrl(t)),t.data&&t.soundType&&(o.type=t.soundType)},r.prototype.onLoadFinish=function(e){var t=e.$target;t.removeEventListener(egret.Event.COMPLETE,this.onLoadFinish,this),t.removeEventListener(egret.IOErrorEvent.IO_ERROR,this.onLoadFinish,this);var r=this.resItemDic[t.$hashCode];delete this.resItemDic[t.$hashCode];var i=r.item,o=r.func;i.loaded=e.$type==egret.Event.COMPLETE,i.loaded&&this.analyzeData(i,t),o.call(r.thisObject,i)},r.prototype.analyzeData=function(e,t){var r=e.url;!this.soundDic[r]&&t&&(this.soundDic[r]=t)},r.prototype.getRes=function(e){return this.soundDic[e]},r.prototype.hasRes=function(e){return!!this.getRes(e)},r.prototype.destroyRes=function(e){return!!this.soundDic[e]&&(delete this.soundDic[e],!0)},r}(e.AnalyzerBase);e.SoundAnalyzer=t}(RES||(RES={}));var RES;!function(e){var t=function(t){function r(){t.call(this),this.sheetMap={},this.recyclerIamge=[],this._dataFormat=egret.HttpResponseType.TEXT}return __extends(r,t),r.prototype.onLoadFinish=function(e){var t=e.target,r=this.resItemDic[t.$hashCode];delete this.resItemDic[t.hashCode];var i=r.item,o=r.func;if(i.loaded=e.type==egret.Event.COMPLETE,i.loaded)if(t instanceof egret.HttpRequest){i.loaded=!1;var n=this.analyzeConfig(i,t.response);if(n)return this.loadImage(n,r),void this.recycler.push(t)}else this.analyzeBitmap(i,t.data);t instanceof egret.HttpRequest?this.recycler.push(t):this.recyclerIamge.push(t),o.call(r.thisObject,i)},r.prototype.analyzeConfig=function(e,t){var r,i=e.url,o="";try{var n=t;r=JSON.parse(n)}catch(r){egret.$warn(1017,e.url,t)}if(r)if(this.sheetMap[i]=r,r.file)o=this.getRelativePath(e.url,r.file);else{var s=e.url.split("?"),a=s[0].split("/");a[a.length-1]=a[a.length-1].split(".")[0]+".png",o="";for(var u=0;u<a.length;u++)o+=a[u]+(u<a.length-1?"/":"");2==s.length&&(o+=s[2])}return o},r.prototype.analyzeBitmap=function(e,t){var r=e.url;if(!this.fileDic[r]&&t){var i=this.sheetMap[r];delete this.sheetMap[r];var o="sheet"==e.type?"":r,n=this.parseAnimation(t,i,o);this.fileDic[r]=n}},r.prototype.getRelativePath=function(e,t){e=e.split("\\").join("/");var r=e.lastIndexOf("/");return e=r!=-1?e.substring(0,r+1)+t:t},r.prototype.parseAnimation=function(e,t,r){for(var i,o=Object.keys(t.mc),n=t.mc[o[0]].frames,s=n.length,a=[],u=0;u<s;u++){i=t.res[n[u].res];var c=new egret.Texture;c._bitmapData=e,c.$initData(i.x,i.y,i.w,i.h,n[u].x,n[u].y,n[u].sourceW,n[u].sourceH,e.width,e.height)}return a},r.prototype.destroyRes=function(e){var t=this.fileDic[e];return!!t&&(delete this.fileDic[e],!0)},r.prototype.loadImage=function(t,r){var i=this.getImageLoader();this.resItemDic[i.hashCode]=r,i.load(e.getVirtualUrl(t))},r.prototype.getImageLoader=function(){var e=this.recyclerIamge.pop();return e||(e=new egret.ImageLoader,e.addEventListener(egret.Event.COMPLETE,this.onLoadFinish,this),e.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onLoadFinish,this)),e},r}(e.BinAnalyzer);e.AnimationAnalyzer=t}(RES||(RES={}));var RES;!function(e){var t=function(e){function t(){e.call(this),this._dataFormat=egret.HttpResponseType.TEXT}return __extends(t,e),t.prototype.analyzeData=function(e,t){var r=e.url;if(!this.fileDic[r]&&t)try{var i=t,o=egret.XML.parse(i);this.fileDic[r]=o}catch(e){}},t}(e.BinAnalyzer);e.XMLAnalyzer=t}(RES||(RES={}));var RES;!function(e){e.ImageProcessor={onLoadStart:function(e,t){var r=this,i=function(i,o){var n=function(){var r=a.data;e.save(t,r),i(t)},s=function(){o()},a=new egret.ImageLoader;a.addEventListener(egret.Event.COMPLETE,n,r),a.addEventListener(egret.IOErrorEvent.IO_ERROR,s,r),a.load(t.url)};return new Promise(i)},onRemoveStart:function(e,t){return Promise.resolve()}}}(RES||(RES={}));var RES;!function(e){function t(e,t){I.registerAnalyzer(e,t)}function r(e,t){I.loadConfig()}function i(e,t){void 0===t&&(t=0),I.loadGroup(e,t)}function o(e){return I.isGroupLoaded(e)}function n(t){return I.getGroupByName(t).map(function(t){return e.ResourceItem.convertToResItem(t)})}function s(e,t,r){return void 0===r&&(r=!1),I.createGroup(e,t,r)}function a(e){return I.hasRes(e)}function u(e,t){void 0===t&&(t=""),I.parseConfig(e,t)}function c(e){return I.getRes(e)}function h(e,t,r){I.getResAsync(e,t,r)}function l(e,t,r,i){void 0===i&&(i=""),I.getResByUrl(e,t,r,i)}function p(e,t){return I.destroyRes(e,t)}function f(e){I.setMaxLoadingThread(e)}function d(e){I.setMaxRetryTimes(e)}function g(e,t,r,i,o){void 0===i&&(i=!1),void 0===o&&(o=0),I.addEventListener(e,t,r,i,o)}function y(e,t,r,i){void 0===i&&(i=!1),I.removeEventListener(e,t,r,i)}function v(e){return e.url}function R(e){return I.getVirtualUrl(e)}function m(e){I.addResourceData(e)}function E(t,r){return function(i){var o,n="json";o="string"==typeof r?r:r(),0!=o.lastIndexOf("/")&&(o+="/"),e.configItem={url:t,resourceRoot:o,type:n,name:t}}}var L={};e.host={get resourceConfig(){return e.configInstance},execute:function(t,r){return t.onLoadStart(e.host,r)},save:function(e,t){L[e.url]=t},get:function(e){return L[e.url]},isSupport:function(e){return e.url.indexOf("png")>=0||e.url.indexOf("jpg")>=0}},e.registerAnalyzer=t,e.loadConfig=r,e.loadGroup=i,e.isGroupLoaded=o,e.getGroupByName=n,e.createGroup=s,e.hasRes=a,e.parseConfig=u,e.getRes=c,e.getResAsync=h,e.getResByUrl=l,e.destroyRes=p,e.setMaxLoadingThread=f,e.setMaxRetryTimes=d,e.addEventListener=g,e.removeEventListener=y,e.$getVirtualUrl=v,e.getVirtualUrl=R,e.$addResourceData=m;var D=function(t){function r(){t.call(this),this.analyzerDic={},this.analyzerClassMap={},this.callLaterFlag=!1,this.configComplete=!1,this.loadedGroups=[],this.groupNameList=[],this.asyncDic={},this._loadedUrlTypes={},this.init()}return __extends(r,t),r.prototype.$getAnalyzerByType=function(e){var t=this.analyzerDic[e];if(!t){var r=this.analyzerClassMap[e];t=this.analyzerDic[e]=new r}return t},r.prototype.parseResKey=function(e){e=this.resConfig.getKeyByAlias(e);var t=e.indexOf("#");return t>=0?{key:e.substr(0,t),subkey:e.substr(t+1)}:{key:e,subkey:""}},r.prototype.registerAnalyzer=function(e,t){this.analyzerClassMap[e]=t},r.prototype.init=function(){var t=this.analyzerClassMap;t.bin=e.BinAnalyzer,t.image=e.ImageAnalyzer,t.text=e.TextAnalyzer,t.json=e.JsonAnalyzer,t.sheet=e.SheetAnalyzer,t.font=e.FontAnalyzer,t.sound=e.SoundAnalyzer,t.xml=e.XMLAnalyzer,this.resConfig=new e.ResourceConfig,this.resLoader=new e.ResourceLoader,this.resLoader.callBack=this.onResourceItemComp,this.resLoader.resInstance=this,this.resLoader.addEventListener(e.ResourceEvent.GROUP_COMPLETE,this.onGroupComp,this),this.resLoader.addEventListener(e.ResourceEvent.GROUP_LOAD_ERROR,this.onGroupError,this)},r.prototype.loadConfig=function(){this.callLaterFlag||(egret.callLater(this.startLoadConfig,this),this.callLaterFlag=!0)},r.prototype.startLoadConfig=function(){this.callLaterFlag=!1;var t=e.configItem;this.resLoader.loadGroup([t],r.GROUP_CONFIG,Number.MAX_VALUE)},r.prototype.isGroupLoaded=function(e){return this.loadedGroups.indexOf(e)!=-1},r.prototype.getGroupByName=function(e){return this.resConfig.getGroupByName(e)},r.prototype.loadGroup=function(t,r){if(void 0===r&&(r=0),this.loadedGroups.indexOf(t)!=-1)return void e.ResourceEvent.dispatchResourceEvent(this,e.ResourceEvent.GROUP_COMPLETE,t);if(!this.resLoader.isGroupInLoading(t))if(this.configComplete){var i=this.resConfig.getGroupByName(t);this.resLoader.loadGroup(i,t,r)}else this.groupNameList.push({name:t,priority:r})},r.prototype.createGroup=function(e,t,r){if(void 0===r&&(r=!1),r){var i=this.loadedGroups.indexOf(e);i!=-1&&this.loadedGroups.splice(i,1)}return this.resConfig.createGroup(e,t,r)},r.prototype.onGroupComp=function(t){if(t.groupName==r.GROUP_CONFIG){var i=this.$getAnalyzerByType(e.configItem.type),o=i.getRes(e.configItem.url);i.destroyRes(e.configItem.url),this.resConfig.parseConfig(o,"resource"),this.configComplete=!0,e.ResourceEvent.dispatchResourceEvent(this,e.ResourceEvent.CONFIG_COMPLETE),this.loadDelayGroups()}else this.loadedGroups.push(t.groupName),this.dispatchEvent(t)},r.prototype.loadDelayGroups=function(){var e=this.groupNameList;this.groupNameList=[];for(var t=e.length,r=0;r<t;r++){var i=e[r];this.loadGroup(i.name,i.priority)}},r.prototype.onGroupError=function(t){t.groupName==r.GROUP_CONFIG?e.ResourceEvent.dispatchResourceEvent(this,e.ResourceEvent.CONFIG_LOAD_ERROR):this.dispatchEvent(t)},r.prototype.hasRes=function(e){var t=this.parseResKey(e).key;return null!=this.resConfig.getResource(t)},r.prototype.parseConfig=function(e,t){console.warn("已经废弃的方法"),this.resConfig.parseConfig(e,t)},r.prototype.getRes=function(t){var r=this.parseResKey(t),i=r.key,o=r.subkey,n=this.resConfig.getResource(i);return n&&e.host.isSupport(n)?e.host.get(n):this.$getResourceViaAnalyzer(n,o)},r.prototype.$getResourceViaAnalyzer=function(e,t){if(!e)return null;var r=this.$getAnalyzerByType(e.type);return r.getRes(e.url,t)},r.prototype.getResAsync=function(e,t,r){var i=this.parseResKey(e),e=i.key,o=(i.subkey,this.resConfig.getResource(e,!0)),n=o.url,s=this.$getResourceViaAnalyzer(o);if(s)return void egret.$callAsync(t,r,s,e);var a={compFunc:t,thisObject:r};this.asyncDic[n]?this.asyncDic[n].push(a):(this.asyncDic[n]=[a],this.resLoader.loadItem(o))},r.prototype.getResByUrl=function(e,t,r,i){void 0===i&&(i="");var o=this.resConfig.getResource(e);o||this.resConfig.addResourceData({name:e,url:e}),this.getResAsync(e,t,r)},r.prototype.onResourceItemComp=function(e){var t=this.asyncDic[e.url];delete this.asyncDic[e.url];for(var r=this.$getAnalyzerByType(e.type),i=t.length,o=0;o<i;o++){var n=t[o],s=r.getRes(e.url);n.compFunc.call(n.thisObject,s,e.url)}},r.prototype.destroyRes=function(e,t){void 0===t&&(t=!0);var r=this.resConfig.getGroup(e);if(r&&r.length>0){var i=this.loadedGroups.indexOf(e);i!=-1&&this.loadedGroups.splice(i,1);for(var o=0,n=r;o<n.length;o++){var s=n[o];if(!t&&this.isResInLoadedGroup(s));else{s.loaded=!1;var a=this.$getAnalyzerByType(s.type);a.destroyRes(s.url),this.removeLoadedGroupsByItemName(s.url)}}return!0}var s=this.resConfig.getResource(e);if(s){s.loaded=!1,a=this.$getAnalyzerByType(s.type);var u=a.destroyRes(e);return this.removeLoadedGroupsByItemName(s.url),u}return console.warn("无法删除指定组:"+e),!1},r.prototype.removeLoadedGroupsByItemName=function(e){for(var t=this.loadedGroups,r=t.length,i=0;i<r;i++)for(var o=this.resConfig.getGroupByName(t[i],!0),n=o.length,s=0;s<n;s++){var a=o[s];if(a.name==e){t.splice(i,1),i--,r=t.length;break}}},r.prototype.isResInLoadedGroup=function(e){for(var t=this.loadedGroups,r=t.length,i=0;i<r;i++)for(var o=this.resConfig.getGroupByName(t[i],!0),n=o.length,s=0;s<n;s++){var a=o[s];if(a.url==e.url)return!0}return!1},r.prototype.setMaxLoadingThread=function(e){e<1&&(e=1),this.resLoader.thread=e},r.prototype.setMaxRetryTimes=function(e){e=Math.max(e,0),this.resLoader.maxRetryTimes=e},r.prototype.addResourceData=function(e){this.resConfig.addResourceData(e)},r.prototype.getVirtualUrl=function(e){var t=this.resConfig.getResource(e);return t?t.url:(console.warn("warn","res","1"),e)},r.GROUP_CONFIG="RES__CONFIG",__decorate([e.checkDecorator],r.prototype,"loadConfig",null),__decorate([e.checkNull],r.prototype,"getRes",null),r}(egret.EventDispatcher);e.Resource=D;var I=new D;e.mapConfig=E}(RES||(RES={}));var egret;!function(e){e.$locale_strings=e.$locale_strings||{},e.$locale_strings.zh_CN=e.$locale_strings.zh_CN||{};var t=e.$locale_strings.zh_CN;t[3200]="RES.createGroup()传入了配置中不存在的键值: {0}",t[3201]='RES加载了不存在或空的资源组:"{0}"',t[3202]="请不要使用不同的类型方式来加载同一个素材！",t[3203]="找不到指定文件类型的解析器:{0}。 请先在项目初始化里注册指定文件类型的解析器，再启动资源加载。"}(egret||(egret={}));